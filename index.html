<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mangistau Parks Map</title>

<style>
html, body {
  margin: 0;
  height: 100%;
  overflow: hidden;
  font-family: Arial, sans-serif;
}

body {
  display: flex;
}

/* Sidebar */
.sidebar {
  width: 300px;
  background: #f4f4f4;
  padding: 20px;
  box-sizing: border-box;
  overflow-y: auto;
}

.sidebar h2 {
  margin-top: 0;
}

.park-item {
  padding: 10px;
  cursor: pointer;
  border-bottom: 1px solid #ddd;
}

.park-item:hover {
  background: #e6e6e6;
}

.park-item.active {
  background: #cfe4ff;
  font-weight: bold;
}

.explore-btn {
  margin-top: 20px;
  width: 100%;
  padding: 12px;
  font-size: 16px;
  background: #007bff;
  color: white;
  border: none;
  cursor: pointer;
  opacity: 0.5;
}

.explore-btn.enabled {
  opacity: 1;
}

/* Map */
.map-wrapper {
  flex: 1;
  background: black;
  position: relative;
  overflow: hidden;
}

.map {
  position: absolute;
  inset: 0;
  width: max(100vw, 100vh);
  height: max(100vw, 100vh);
  aspect-ratio: 1 / 1;
  transform-origin: 0 0;
  cursor: grab;
}

.map img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  pointer-events: none;
  user-select: none;
}

/* Markers */
.marker {
  position: absolute;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  transform: translate(-50%, -50%);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 10px;
}

.marker.blue { background: blue; }
.marker.red { background: red; }

/* Zoom controls */
.zoom-controls {
  position: absolute;
  right: 20px;
  bottom: 20px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  z-index: 10;
}

.zoom-controls button {
  width: 42px;
  height: 42px;
  font-size: 20px;
  font-weight: bold;
  background: white;
  border: 1px solid #ccc;
  cursor: pointer;
  border-radius: 6px;
}

.zoom-controls button:hover {
  background: #f0f0f0;
}
</style>
</head>

<body>

<!-- Sidebar -->
<div class="sidebar">
  <h2>Parks</h2>
  <div id="parkList"></div>
  <button id="exploreBtn" class="explore-btn" disabled>Explore</button>
</div>

<!-- Map -->
<div class="map-wrapper" id="mapWrapper">
  <div class="map" id="map">
    <img src="mangistau-map.jpeg" alt="Mangistau Map">
    <div id="markers"></div>
  </div>

  <div class="zoom-controls">
    <button id="zoomIn">+</button>
    <button id="zoomOut">−</button>
    <button id="resetView" title="Reset view">⟳</button>
  </div>
</div>

<script>
/* ================= DATA ================= */
const parks = [
  { name: "Акбота Парк", x: 24, y: 60, link: "https://maps.app.goo.gl/dEtzuSZfk4yh6Gov9" },
  { name: "Rixos Water World Aktau", x: 24, y: 60, link: "https://maps.app.goo.gl/xCEZB2MawwKLDs377" },
  { name: "Мұнайшылар саябағы", x: 42, y: 63, link: "https://maps.app.goo.gl/4qc4UhuRhtVSzBXQ9" },
  { name: "Бесінбай қорымы", x: 17, y: 44, link: "https://maps.app.goo.gl/Q5gn33Xdid8ynS7n8" },
  { name: "Beket-Ata mosque", x: 72, y: 30, link: "https://maps.app.goo.gl/sYSw35sosBKbQCBt6" },
  { name: "Тамшалы. Спуск по лестнице.", x: 22, y: 40, link: "https://maps.app.goo.gl/MuBqcg4zmPaBhB3n8" },
];

/* ================= ELEMENTS ================= */
const parkList = document.getElementById("parkList");
const markersContainer = document.getElementById("markers");
const exploreBtn = document.getElementById("exploreBtn");
const map = document.getElementById("map");
const wrapper = document.getElementById("mapWrapper");

/* ================= STATE ================= */
let selectedPark = null;
let scale = 1;
let x = 0;
let y = 0;

/* ================= HELPERS ================= */
function clampPosition() {
  const w = wrapper.getBoundingClientRect();
  const mapW = map.offsetWidth * scale;
  const mapH = map.offsetHeight * scale;

  const minX = Math.min(0, w.width - mapW);
  const minY = Math.min(0, w.height - mapH);

  x = Math.max(minX, Math.min(0, x));
  y = Math.max(minY, Math.min(0, y));
}

function applyTransform() {
  clampPosition();
  map.style.transform = `translate(${x}px, ${y}px) scale(${scale})`;
}

/* ================= PARK SELECTION ================= */
function selectPark(park) {
  selectedPark = park;

  document.querySelectorAll(".park-item").forEach(item =>
    item.classList.toggle("active", item.dataset.name === park.name)
  );

  // Highlight all markers with the same coordinates as the selected park
  document.querySelectorAll(".marker").forEach(marker => {
    if(marker.dataset.coord === `${park.x}-${park.y}` && marker.dataset.name === park.name){
      marker.classList.remove("blue");
      marker.classList.add("red");
    } else {
      marker.classList.remove("red");
      marker.classList.add("blue");
    }
  });

  exploreBtn.disabled = false;
  exploreBtn.classList.add("enabled");
}

/* ================= CREATE UI ================= */
// Count duplicates to offset overlapping markers
const coordCounts = {};

parks.forEach((park, index) => {
  const key = `${park.x}-${park.y}`;
  if(!coordCounts[key]) coordCounts[key] = 0;
  const offsetIndex = coordCounts[key]++;
  
  // Sidebar
  const item = document.createElement("div");
  item.className = "park-item";
  item.textContent = park.name;
  item.dataset.name = park.name;
  item.onclick = () => selectPark(park);
  parkList.appendChild(item);

  // Marker
  const marker = document.createElement("div");
  marker.className = "marker blue";
  marker.dataset.name = park.name;
  marker.dataset.coord = key;
  
  // Slight offset for overlapping markers
  const offset = offsetIndex * 18; // 18px spacing
  marker.style.left = `calc(${park.x}% + ${offset}px)`;
  marker.style.top = `calc(${park.y}% + ${offset}px)`;
  
  marker.onclick = () => selectPark(park);
  markersContainer.appendChild(marker);
});

/* ================= NAVIGATION ================= */
exploreBtn.onclick = () => {
  if (!selectedPark) return;
  location.href = selectedPark.link;
};

/* ================= PAN ================= */
let dragging = false;
let startX, startY;

map.addEventListener("mousedown", e => {
  dragging = true;
  map.style.cursor = "grabbing";
  startX = e.clientX - x;
  startY = e.clientY - y;
});

window.addEventListener("mousemove", e => {
  if (!dragging) return;
  x = e.clientX - startX;
  y = e.clientY - startY;
  applyTransform();
});

window.addEventListener("mouseup", () => {
  dragging = false;
  map.style.cursor = "grab";
});

/* ================= ZOOM (WHEEL) ================= */
wrapper.addEventListener("wheel", e => {
  e.preventDefault();
  const rect = wrapper.getBoundingClientRect();
  const mx = e.clientX - rect.left;
  const my = e.clientY - rect.top;

  const factor = e.deltaY < 0 ? 1.1 : 0.9;
  const newScale = Math.min(Math.max(1, scale * factor), 4);

  x = mx - ((mx - x) * newScale) / scale;
  y = my - ((my - y) * newScale) / scale;
  scale = newScale;

  applyTransform();
}, { passive: false });

/* ================= ZOOM BUTTONS ================= */
function zoomAtCenter(factor) {
  const rect = wrapper.getBoundingClientRect();
  const cx = rect.width / 2;
  const cy = rect.height / 2;

  const newScale = Math.min(Math.max(1, scale * factor), 4);

  x = cx - ((cx - x) * newScale) / scale;
  y = cy - ((cy - y) * newScale) / scale;
  scale = newScale;

  applyTransform();
}

document.getElementById("zoomIn").onclick = () => zoomAtCenter(1.2);
document.getElementById("zoomOut").onclick = () => zoomAtCenter(0.8);

/* ================= RESET ================= */
document.getElementById("resetView").onclick = () => {
  scale = 1;
  x = 0;
  y = 0;
  applyTransform();
};
</script>

</body>
</html>
